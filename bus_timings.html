<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="">
    <title>Destination - Bus Timings</title>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- CSS -->
    <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">
    <link rel="icon" href="images/favicon.ico" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css?family=Lemonada&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="animate.css">
    <link rel="stylesheet" type="text/css" href="hover.css">
    <link rel="stylesheet" type="text/css" href="font-awesome-4.7.0/css/font-awesome.css">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">

    <!-- JS -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>

    <!-- Map JS -->
    <script type="text/javascript" src="https://gothere.sg/jsapi?sensor=false"> </script>
    <script type="text/javascript" src="mapScript.js"> </script>
    

    <style type="text/css">
body, p, h1, h2, h3, h4, h5 ,button, input, a, label, select, .but{
    font-family: 'Lemonada', cursive;
}

        #_gdir{font-size:14px;}
        #_gdir > div{font-weight:bold;text-align:center;}
        #_gdir p._sum{text-align:center;font-weight:bold;color:#3a741f;}
        #_gdir ol{padding:10px 30px 10px 40px;}
        #_gdir ol li{border-bottom:1px solid #ccc;}
        #_gdir ol li div p.r{font-size:11px;color:#3a741f;text-align:right;}
        #_gdir div._copy{font-size:12px;font-weight:normal;}
    
        .banner {display:none}
.w3-left, .w3-right, .w3-badge {cursor:pointer}
.w3-badge {height:13px;width:13px;padding:0}

.head {
            max-width: 100%;
            max-height: 100%;
            margin: auto;
            display: block;
            height: auto;
            }

.shadowfilter {
	-webkit-filter: drop-shadow(0px 0px 8px rgba(194, 249, 255, 0.8));
	-webkit-transition: all 0.5s linear;
	-o-transition: all 0.5s linear;
	transition: all 0.5s linear;	
}
.shadowfilter:hover {
	-webkit-filter: drop-shadow(0px 0px 12px rgba(0, 231, 255, 0.8));
}

.bgshadow{
    -webkit-filter: drop-shadow(0px 12px 0px rgba(65, 65, 65, 0.8));
}

 .nav-link{
border-color: rgb(81, 148, 175)!important;
border-width: 5px!important;
border-left-style: solid;
margin: 20px!important;
color: rgb(241, 243, 243)!important;
}

.nav-link:hover{
border-color: rgb(196, 230, 243)!important;
color: rgb(188, 223, 214)!important;
}

.nav-link:active{
    border-color: rgb(237, 255, 137)!important;
color: rgb(209, 223, 228)!important;
}

.active{
    border-color: rgb(237, 255, 137)!important;
color: rgb(239, 252, 191)!important;
}

.arr{
    color: rgb(225, 239, 245);
    font-size: 20px;
    border-style: solid;
    border-color: transparent;
    border-width: 30px;
    border-radius: 20px;
}

.arr:hover{
    color: skyblue;
    font-size: 20px;
    border-style: solid;
    border-color: transparent;
    border-width: 30px;
    border-radius: 20px;
    background-color: rgba(70, 131, 180, 0.301);
}

.toSection{
    color: rgb(72, 109, 131);
    font-size: 20px;
    border-style: solid;
    border-color: transparent;
    border-width: 20px;
    border-radius: 20px;
}

.toSection:hover{
    color: rgb(239, 250, 255);
    font-size: 20px;
    border-style: solid;
    border-color: transparent;
    border-width: 20px;
    border-radius: 20px;
    background-color: rgba(104, 159, 204, 0.301);
}

.text-focus-in {
	-webkit-animation: text-focus-in 1s cubic-bezier(0.550, 0.085, 0.680, 0.530) both;
	        animation: text-focus-in 1s cubic-bezier(0.550, 0.085, 0.680, 0.530) both;
}

.card-body{
color: rgb(227, 236, 243);
background-color: rgba(57, 97, 116, 0.349);
}

.card-body h4 ,.card-body p{
    padding: 30px;
    text-align: center;
    vertical-align: middle;
}

a:hover{
    text-decoration: none;
}

.but {
	box-shadow:inset 0px 1px 0px 0px #ffffff;
	background:linear-gradient(to bottom, #f9f9f9 5%, #e9e9e9 100%);
	background-color:#f9f9f9;
	border-radius:6px;
	border:1px solid #dcdcdc;
	display:inline-block;
	cursor:pointer;
	color:#666666;
	font-family:Arial;
	font-size:15px;
	font-weight:bold;
	padding:6px 24px;
	text-decoration:none;
	text-shadow:0px 1px 0px #ffffff;
}
.but:hover {
	background:linear-gradient(to bottom, #e9e9e9 5%, #f9f9f9 100%);
	background-color:#e9e9e9;
}
.but:active {
	position:relative;
	top:1px;
}

.text-flicker-in-glow {
	-webkit-animation: text-flicker-in-glow 4s linear both;
	        animation: text-flicker-in-glow 4s linear both;
}
    </style>
</head>

<body style="background-color: rgb(125, 171, 255);background-image: url(images/map.gif) ;background-position: center; background-size: cover;">

    <header style="width:100%;">
        <nav class="nav navbar navbar-expand-md navbar-dark" style="background-color: rgba(14, 37, 46, 0.418)!important; height: 60px; z-index: 30;">
            <a class="nav-pop navbar-brand" style="color: white; font-size: x-large; padding: 0 30px 0 10px; width: 200px;" href="index.html"><img src="images/destination-logo.png" style="width: 10%;">Destination</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        
            <div class="collapse navbar-collapse" id="navbarsExampleDefault">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item"   style="background-color: rgba(14, 37, 46, 0.24)!important;">
                        <a class="nav-link active text-flicker-in-glow" href="bus_timings.html">Bus is coming!<span class="sr-only">(current)</span></a>
                    </li>
                </ul>
            </div>
        </nav>
</header>

<section class="container-fluid" style="width: 100%;background-color: rgba(146, 192, 223, 0.267); padding: 20px;">

    <table id="trainState" class="container" style="color: #ffffff;"></table>    
    <hr>
    
<div class="container-fluid">
    <form class="container" onsubmit="busSearch()">
         <input type="text" class="form-control" name="" id="buscode" aria-describedby="helpId" placeholder="Bus Stop Code eg. 22591">
         <hr>
         <button id="submit" class="but" onclick="busSearch()" class="btn btn-primary">Submit</button>
    <button class="but" onclick="clearLS()">Clear</button>
</form>
    <hr>

    <table id="busNo" class="container" style="padding: 100px; background-color: rgba(27, 27, 27, 0.26);text-align: center;color: rgb(250, 250, 250) ;width:30%;"></table>
</div>

</section>


<script>   

//Clear Local Storage
    function clearLS(){
    localStorage.clear();
    history.go(0);
}

//Bus Arrival Searches
    function busSearch(){
        //@paramssettings
        event.preventDefault();
        var params = {
        // //YYYY-MM-DD[T]HH:mm:ss(SGT)
        "BusStopCode": "",
        };

        //API Call
        $.ajax({
        type: "GET",
        crossDomain: true,
        dataType: 'json',
        contentType: "text/plain",
        url: "https://cors-anywhere.herokuapp.com/http://datamall2.mytransport.sg/ltaodataservice/BusArrivalv2?",
        headers: { 'AccountKey' : 'jYPJun3ORe2iZ18XLuN2zw==',
        'accept' : 'application/json'}, 
            
        data: { "BusStopCode": document.getElementById("buscode").value},
        // crossDomain: true,
        //@data returning JSON data
        success: function(data) {

var busNo = [];
        for (var i=0; i < data.Services.length; i++){
            busNo = data.Services[i].ServiceNo;
            busNext = data.Services[i].NextBus.EstimatedArrival;
            busNextNext = data.Services[i].NextBus2.EstimatedArrival;
            busNextNextNext = data.Services[i].NextBus3.EstimatedArrival;

            busNextOccp = data.Services[i].NextBus.Load;
            busNextNextOccp = data.Services[i].NextBus2.Load;
            busNextNextNextOccp = data.Services[i].NextBus3.Load;

            busNextFeat = data.Services[i].NextBus.Feature;
            busNextNextFeat = data.Services[i].NextBus2.Feature;
            busNextNextNextFeat = data.Services[i].NextBus3.Feature;

            busNextType = data.Services[i].NextBus.Type;
            busNextNextType = data.Services[i].NextBus2.Type;
            busNextNextNextType = data.Services[i].NextBus3.Type;


//Convert to Time
            function addZero(x, n) {
  while (x.toString().length < n) {
    x = "0" + x;
  }
  return x;
}

  var busN = new Date(busNext);
  var hDN = addZero(busN.getHours(), 2);
  var mDN = addZero(busN.getMinutes(), 2);
  var sDN = addZero(busN.getSeconds(), 2);
busNext = hDN + ":" + mDN + ":" + sDN;

var busNN = new Date(busNextNext);
  var hDNN = addZero(busNN.getHours(), 2);
  var mDNN = addZero(busNN.getMinutes(), 2);
  var sDNN = addZero(busNN.getSeconds(), 2);
busNextNext = hDNN + ":" + mDNN + ":" + sDNN;

var busNNN = new Date(busNextNextNext);
  var hDNNN = addZero(busNNN.getHours(), 2);
  var mDNNN = addZero(busNNN.getMinutes(), 2);
  var sDNNN = addZero(busNNN.getSeconds(), 2);
busNextNextNext = hDNNN + ":" + mDNNN + ":" + sDNNN;


// Printing Format
    var eachNo = "<tr>" + "<th>" + "Bus No: "  + busNo + "</th>" +  "</tr>" +
                            "<tr>" + "<td>" + "Next Bus: "  + busNext + "</td>" + "<td>" + busNextOccp + "</td>"
                                + "<td>" + busNextFeat + "</td>"
                                + "<td>" + busNextType + "</td>" + "</tr>" +
                            "<tr>" + "<td>" + "Next Bus2: " + busNextNext + "</td>" + "<td>" + busNextNextOccp + "</td>"
                                + "<td>" + busNextNextFeat + "</td>"
                                + "<td>" + busNextNextType + "</td>" + "</tr>" +
                            "<tr>" + "<td>" + "Next Bus3: " + busNextNextNext + "</td>" + "<td>" + busNextNextNextOccp + "</td>"
                                + "<td>" + busNextNextNextFeat + "</td>"
                                + "<td>" + busNextNextNextType + "</td>" + "</tr>"

            //Prints out                    
            document.getElementById("busNo").innerHTML += eachNo;
            console.log("Bus No: " + busNo);

//Set to Local Storage
localStorage.setItem("buses", document.getElementById("busNo").innerHTML);
            
        }
        },

        error: function(error){
            console.log(error);
        }

        });
    } 

//When document is ready
    $(document).ready(function(){
        document.getElementById("busNo").innerHTML = localStorage.getItem("buses");;

//API Calls
        $.ajax({
        type: "GET",
        crossDomain: true,
        dataType: 'json',
        contentType: "text/plain",
        url: "https://cors-anywhere.herokuapp.com/http://datamall2.mytransport.sg/ltaodataservice/TrainServiceAlerts",
        headers: { 'AccountKey' : 'jYPJun3ORe2iZ18XLuN2zw==',
        'accept' : 'application/json'}, 
            
        // crossDomain: true,
        //@data returning JSON data
        data: {},
        success: function(data) {
        console.log(data.value.Status);
        var state;
        var trainStatus;

        //If train is avaliable
        if (data.value.Status == "1"){
            state = "Normal";
            trainStatus = "<tr>" + "<th>" + "MRT Train Status: "  + state + "</th>" +  "</tr>"
            document.getElementById("trainState").innerHTML += trainStatus;

        }else if (data.value.Status == "2"){ //If train is not avaliable
            state = "Disrupted";

            //Prinint Format
            trainStatus = "<tr>" + "<th>" + "MRT Train Status: "  + state + "</th>" +  "</tr>" +

                            "<tr>" + "<td>" + "Affected Segments: "  + data.value.Line + "</td>"
                                + "<td>" + "Direction: "  + data.value.Direction + "</td>" 
                                + "<td>" + "Stations: "  + data.value.Stations + "</td>" + "</tr>"

                                + "<tr>"  + "<td>" + "Free Public Bus: " + data.value.FreePublicBus + "</td>"
                                + "<td>" + "Free MRT Shuttle: " + data.value.FreeMRTShuttle + data.value.MRTShuttleDirection + "</td>"
                                + "<td>" + "Message: " + data.value.Message + "</td>"
                                + "</tr>"

            // Prints
            document.getElementById("trainState").innerHTML += trainStatus;
        }
        },

        error: function(error){
            console.log(error);
        }

        });


})
</script>
</body>
</html>
