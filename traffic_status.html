<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="">
    <title>Destination - Finding Taxi</title>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- CSS -->
    <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">
    <link rel="icon" href="images/favicon.ico" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css?family=Lemonada&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="animate.css">
    <link rel="stylesheet" type="text/css" href="hover.css">
    <link rel="stylesheet" type="text/css" href="font-awesome-4.7.0/css/font-awesome.css">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">

    <!-- JS -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>

    <!-- Map JS -->
    <script type="text/javascript" src="https://gothere.sg/jsapi?sensor=false"> </script>
    <script type="text/javascript" src="mapScript.js"> </script>
    

    <style type="text/css">
body, p, h1, h2, h3, h4, h5 ,button, input, a, label, select, .but{
    font-family: 'Lemonada', cursive;
}
        #_gdir{font-size:14px;}
        #_gdir > div{font-weight:bold;text-align:center;}
        #_gdir p._sum{text-align:center;font-weight:bold;color:#3a741f;}
        #_gdir ol{padding:10px 30px 10px 40px;}
        #_gdir ol li{border-bottom:1px solid #ccc;}
        #_gdir ol li div p.r{font-size:11px;color:#3a741f;text-align:right;}
        #_gdir div._copy{font-size:12px;font-weight:normal;}
    
        .banner {display:none}
.w3-left, .w3-right, .w3-badge {cursor:pointer}
.w3-badge {height:13px;width:13px;padding:0}

.head {
            max-width: 100%;
            max-height: 100%;
            margin: auto;
            display: block;
            height: auto;
            }

.shadowfilter {
	-webkit-filter: drop-shadow(0px 0px 8px rgba(194, 249, 255, 0.8));
	-webkit-transition: all 0.5s linear;
	-o-transition: all 0.5s linear;
	transition: all 0.5s linear;	
}
.shadowfilter:hover {
	-webkit-filter: drop-shadow(0px 0px 12px rgba(0, 231, 255, 0.8));
}

.bgshadow{
    -webkit-filter: drop-shadow(0px 12px 0px rgba(65, 65, 65, 0.8));
}

 .nav-link{
border-color: rgb(81, 148, 175)!important;
border-width: 5px!important;
border-left-style: solid;
margin: 20px!important;
color: rgb(241, 243, 243)!important;
}

.nav-link:hover{
border-color: rgb(196, 230, 243)!important;
color: rgb(188, 223, 214)!important;
}

.nav-link:active{
    border-color: rgb(237, 255, 137)!important;
color: rgb(209, 223, 228)!important;
}

.active{
    border-color: rgb(237, 255, 137)!important;
color: rgb(239, 252, 191)!important;
}

.arr{
    color: rgb(225, 239, 245);
    font-size: 20px;
    border-style: solid;
    border-color: transparent;
    border-width: 30px;
    border-radius: 20px;
}

.arr:hover{
    color: skyblue;
    font-size: 20px;
    border-style: solid;
    border-color: transparent;
    border-width: 30px;
    border-radius: 20px;
    background-color: rgba(70, 131, 180, 0.301);
}

.toSection{
    color: rgb(72, 109, 131);
    font-size: 20px;
    border-style: solid;
    border-color: transparent;
    border-width: 20px;
    border-radius: 20px;
}

.toSection:hover{
    color: rgb(239, 250, 255);
    font-size: 20px;
    border-style: solid;
    border-color: transparent;
    border-width: 20px;
    border-radius: 20px;
    background-color: rgba(104, 159, 204, 0.301);
}

.text-focus-in {
	-webkit-animation: text-focus-in 1s cubic-bezier(0.550, 0.085, 0.680, 0.530) both;
	        animation: text-focus-in 1s cubic-bezier(0.550, 0.085, 0.680, 0.530) both;
}

.card-body{
color: rgb(227, 236, 243);
background-color: rgba(57, 97, 116, 0.349);
}

.card-body h4 ,.card-body p{
    padding: 30px;
    text-align: center;
    vertical-align: middle;
}

a:hover{
    text-decoration: none;
}

.but {
	box-shadow:inset 0px 1px 0px 0px #ffffff;
	background:linear-gradient(to bottom, #f9f9f9 5%, #e9e9e9 100%);
	background-color:#f9f9f9;
	border-radius:6px;
	border:1px solid #dcdcdc;
	display:inline-block;
	cursor:pointer;
	color:#666666;
	font-family:Arial;
	font-size:15px;
	font-weight:bold;
	padding:6px 24px;
	text-decoration:none;
	text-shadow:0px 1px 0px #ffffff;
}
.but:hover {
	background:linear-gradient(to bottom, #e9e9e9 5%, #f9f9f9 100%);
	background-color:#e9e9e9;
}
.but:active {
	position:relative;
	top:1px;
}

.text-flicker-in-glow {
	-webkit-animation: text-flicker-in-glow 4s linear both;
	        animation: text-flicker-in-glow 4s linear both;
}

span img{
            height: 200px;
            width: 180px;
        }

    </style>
</head>

<body style="background-color: deepskyblue;">

    <header style="width:100%;">
        <nav class="nav navbar navbar-expand-md navbar-dark" style="background-color: rgba(14, 37, 46, 0.418)!important; height: 60px; z-index: 30;">
            <a class="nav-pop navbar-brand" style="color: white; font-size: x-large; padding: 0 30px 0 10px; width: 200px;" href="index.html"><img src="images/destination-logo.png" style="width: 10%;">Destination</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        
            <div class="collapse navbar-collapse" id="navbarsExampleDefault">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item"   style="background-color: rgba(14, 37, 46, 0.24)!important;">
                        <a class="nav-link active text-flicker-in-glow" href="traffic_status.html">Traffic Jams!<span class="sr-only">(current)</span></a>
                    </li>
                </ul>
            </div>
        </nav>
</header>

<section class="container-fluid" style="width: 100%; ;background-image: url(images/lsLoop.gif); background-position: center; background-size: contain; padding: 20px;">
<div class="container" style="padding: 15px;width: 100%;text-align: center;">
   

    <form action="#" onsubmit="getAddress(this.address.value);return false;">
        <input type="text" class="form-control" name="address" size="64" placeholder="Where are you going to? Eg. Ngee Ann Polytechnic" />
        <input type="submit" class="but" value="Find"/>
        <br>
        <button class="trfImg but">Traffic Images</button>
        <button class="trfInc but">Traffic Incidents</button>
    </form>

    <div id="map" style="width:100%;height:600px;margin-right:20px;float:left;"></div>
    <br><br>
    <form class="container-fluid" action="#" onsubmit="wSearch()">
        <input id ="way" class="form-control" type="text" name="address" size="64" placeholder="Which Expressway are you going to? eg. PIE" />
        <input type="submit" class="but" value="Find"/><br>
        <table id="ways" style="background-color: rgba(170, 169, 169, 0.233); justify-content: center;"></table>
    </form>
</div>
</section>



<script>    
 //Load map
 gothere.load("maps");
var directions, map, geocoder;

//Initialize function
function initialize() {
    if (GBrowserIsCompatible()) {
    // Create the Gothere map object.
    map = new GMap2(document.getElementById("map"));

    // Set the center of the map.
    map.setCenter(new GLatLng(1.362083, 103.819836), 11);
    // Add zoom controls on the top left of the map.
    map.addControl(new GSmallMapControl());
    // Add a scale bar at the bottom left of the map.
    map.addControl(new GScaleControl());
    //Create a geocoder object.
    geocoder = new GClientGeocoder();
    }}


//When button is clicked, show results for Traffic Images
    if($(".trfImg").on('click',function(){
    //@paramssettings

    //Call API
    $.ajax({
    type: "GET",
    dataType: 'json',
    contentType: "text/plain",
    url: "https://api.data.gov.sg/v1/transport/traffic-images",
    headers: {}, 
                
    // crossDomain: true,
    //@data returning JSON data
    success: function(data) {   

        var reading = data.items[0].cameras;
        for (var i=0; i < reading.length; i++){
  
    var lat = [];
    var long = [];
    var cam = [];
    lat += reading[i].location.latitude;
    long += reading[i].location.longitude;
    cam += reading[i].image;
    console.log("Timestamp: " + data.items[0].timestamp);
    // Create a map.
    var selected = new GLatLng(lat, long);

    // Create a new base icon for our custom markers.
    var baseIcon = new GIcon();
            	baseIcon.image = "http://www.google.com/mapfiles/markerA.png";
            	baseIcon.shadow = "http://www.google.com/mapfiles/shadow50.png";
            	baseIcon.iconSize = new GSize(20, 34);
                baseIcon.shadowSize = new GSize(37, 34);
                baseIcon.iconAnchor = new GPoint(9, 34);
                baseIcon.infoWindowAnchor = new GPoint(5, 29);
    var customIcon = new GIcon(baseIcon);
    customIcon.image = "http://www.google.com/mapfiles/marker" + ".png";

    // Create a marker.
    var marker = new GMarker(selected, {icon:customIcon});

    var text = "<span><img" + " src=" + cam + "></span>" + "<br>" 
                    + "<a href=" + cam + ">" + 
                    "Download Image" + "</a>"

    // Add the marker to the map.
    map.addOverlay(marker);
    // Open an info window on the marker.
    marker.bindInfoWindowHtml(text);

    }
}
    });
    }));

//If button is clicked, show results for Traffic Incidents
    if($(".trfInc").on('click',function(){

        //Call API
    $.ajax({
    type: "GET",
    dataType: 'json',
    contentType: "text/plain",
    url: "https://cors-anywhere.herokuapp.com/http://datamall2.mytransport.sg/ltaodataservice/TrafficIncidents",
    headers: { 'AccountKey' : 'jYPJun3ORe2iZ18XLuN2zw==',
        'accept' : 'application/json'}, 
                
    // crossDomain: true,
    //@data returning JSON data
    success: function(data) {   

        var reading = data.value;
        for (var i=0; i < reading.length; i++){
  
    var type = [];
    var msg = [];
    var lat = [];
    var long = [];
    type = reading[i].Type
    msg += reading[i].Message;
    lat += reading[i].Latitude;
    long += reading[i].Longitude;

// Create a map.
var selected = new GLatLng(lat, long);

// Create a new base icon for our custom markers.
var baseIcon = new GIcon();
            baseIcon.image = "http://www.google.com/mapfiles/markerA.png";
            baseIcon.shadow = "http://www.google.com/mapfiles/shadow50.png";
            baseIcon.iconSize = new GSize(20, 34);
            baseIcon.shadowSize = new GSize(37, 34);
            baseIcon.iconAnchor = new GPoint(9, 34);
            baseIcon.infoWindowAnchor = new GPoint(5, 29);
var customIcon = new GIcon(baseIcon);
customIcon.image = "http://www.google.com/mapfiles/markerA" + ".png";

// Create a marker.
var marker = new GMarker(selected, {icon:customIcon});

var text = "<p>" + type + "</p>" + "<br>" 
                + "<p>" + msg + "</p>"

// Add the marker to the map.
map.addOverlay(marker);
// Open an info window on the marker.
marker.bindInfoWindowHtml(text);

    }
}

    });
}))

//Show results for Est Travel Times when Search is made
function wSearch(){
    console.log("Yes")
        event.preventDefault(); //Prevent link from working

        //Call API
    $.ajax({
    type: "GET",
    dataType: 'json',
    contentType: "text/plain",
    url: "https://cors-anywhere.herokuapp.com/http://datamall2.mytransport.sg/ltaodataservice/EstTravelTimes",
    headers: { 'AccountKey' : 'jYPJun3ORe2iZ18XLuN2zw==',
        'accept' : 'application/json'}, 
                
    // crossDomain: true,
    //@data returning JSON data
    success: function(data) {   

        var reading = data.value;
        for (var i=0; i < reading.length; i++){
  
    var name = [];
    var sp = [];
    var ep = [];
    var est = [];
    name = reading[i].Name
    sp += reading[i].StartPoint;
    ep += reading[i].EndPoint;
    est += reading[i].EstTime;


    if (name == document.getElementById("way").value){
    var aye = "<tr>" + "<th>" + "Vehicle Type: "  + name + "</th>" +  "</tr>" 
                            + "<tr>" + "<td>" + "Points: "  + sp + "</td>" + "<td>" + ep + "</td>" + "</tr>"
                            + "<tr>" + "<td>" + "Estimated Time: " + est + "</td>" + "</tr>" 

            document.getElementById("ways").innerHTML += aye;
    }else{
        console.log("error");
    }
}
    }
    })
}

//Geocoder
function getAddress(address) {
            if (geocoder) {
                geocoder.getLatLng(address, function(latlng) {
                    if (!latlng) {
                        alert("Opps, " + address + " not found.");
                    } else {
                        // Center the map at the address and draw a marker.
                        map.setCenter(latlng, 14);
                        var imarker = new GMarker(latlng);
                        map.addOverlay(imarker);
                        imarker.openInfoWindowHtml("<h3>" + address + "</h3>");
                    }
                });
            }
}

gothere.setOnLoadCallback(initialize);

</script>
</body>
</html>